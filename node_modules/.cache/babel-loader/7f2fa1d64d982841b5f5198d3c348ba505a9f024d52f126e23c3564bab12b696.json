{"ast":null,"code":"const {\n  web3\n} = require(\"./web3\");\nconst compileContract = require(\"../contract/ptTrans.json\");\n\n// 取得部署在網路上的智能合約物件 (ganache-cli 或測試網路或主網路)\n// 網路可以在 web3 檔案中選擇\n\n// const getContractObject = () => {\n//     const contractReceipt = require(\"./receipt-metamask.json\");\n//     // 建立智能合約物件/實例\n//     const contractObject = new web3.eth.Contract(\n//         compileContract.abi,\n//         contractReceipt.address\n//     );\n\n//     return contractObject;\n// };\n\nconst getContractObject = () => {\n  // 從 Local Storage 中获取收据地址\n  const receiptAddress = localStorage.getItem('receiptAddress');\n\n  // 如果没有收据地址，则返回 null 或者进行错误处理\n  if (!receiptAddress) {\n    console.error('Receipt address not found in local storage.');\n    return null;\n  }\n\n  // 建立智能合约物件/实例\n  const contractObject = new web3.eth.Contract(compileContract.abi, receiptAddress);\n  return contractObject;\n};\nconst payee = async () => {\n  const contractObject = getContractObject();\n  const result = await contractObject.methods.payee().call();\n  return result;\n};\nconst payer = async () => {\n  const contractObject = getContractObject();\n  const result = await contractObject.methods.payer().call();\n  return result;\n};\nconst amount = async () => {\n  const contractObject = getContractObject();\n  const result = await contractObject.methods.amount().call();\n  return result;\n};\nconst deadline = async () => {\n  const contractObject = getContractObject();\n  const result = await contractObject.methods.deadline().call();\n  return result;\n};\nconst checkContractStatus = async () => {\n  const contractObject = getContractObject();\n  const result = await contractObject.methods.checkContractStatus().call();\n  return result;\n};\nconst finishContract = async () => {\n  const accounts = await web3.eth.getAccounts();\n  const contractObject = getContractObject();\n  const receipt = await contractObject.methods.finishContract().send({\n    from: accounts[0],\n    gas: 1000000\n  });\n  console.info(receipt);\n  console.info(\"Contract successfully finished!\");\n  return receipt;\n};\nconst terminateContract = async () => {\n  const accounts = await web3.eth.getAccounts();\n  const contractObject = getContractObject();\n  const receipt = await contractObject.methods.terminateContract().send({\n    from: accounts[0],\n    gas: 1000000\n  });\n  console.info(receipt);\n  console.info(\"Contract successfully terminated!\");\n  return receipt;\n};\nconst prePay = async value => {\n  const accounts = await web3.eth.getAccounts();\n  const contractObject = getContractObject();\n  const receipt = await contractObject.methods.prePay().send({\n    from: accounts[0],\n    value: web3.utils.toWei(value, 'ether'),\n    gas: 1000000\n  });\n  console.info(receipt);\n  console.info(\"Pre-payment successful!\");\n  return receipt;\n};\nconst shipItem = async () => {\n  const accounts = await web3.eth.getAccounts();\n  const contractObject = getContractObject();\n  const receipt = await contractObject.methods.shipItem().send({\n    from: accounts[0],\n    gas: 1000000\n  });\n  console.info(receipt);\n  console.info(\"Item shipped successfully!\");\n  return receipt;\n};\nconst confirmReceived = async () => {\n  const accounts = await web3.eth.getAccounts();\n  const contractObject = getContractObject();\n  const receipt = await contractObject.methods.confirmReceived().send({\n    from: accounts[0],\n    gas: 1000000\n  });\n  console.info(receipt);\n  console.info(\"Item received successfully!\");\n  return receipt;\n};\nmodule.exports = {\n  payee,\n  payer,\n  amount,\n  deadline,\n  checkContractStatus,\n  finishContract,\n  terminateContract,\n  prePay,\n  shipItem,\n  confirmReceived\n};","map":{"version":3,"names":["web3","require","compileContract","getContractObject","receiptAddress","localStorage","getItem","console","error","contractObject","eth","Contract","abi","payee","result","methods","call","payer","amount","deadline","checkContractStatus","finishContract","accounts","getAccounts","receipt","send","from","gas","info","terminateContract","prePay","value","utils","toWei","shipItem","confirmReceived","module","exports"],"sources":["C:/Users/wwwna/Desktop/test/src/ethereum/logic.js"],"sourcesContent":["const { web3 } = require(\"./web3\");\r\nconst compileContract = require(\"../contract/ptTrans.json\");\r\n\r\n// 取得部署在網路上的智能合約物件 (ganache-cli 或測試網路或主網路)\r\n// 網路可以在 web3 檔案中選擇\r\n\r\n// const getContractObject = () => {\r\n//     const contractReceipt = require(\"./receipt-metamask.json\");\r\n//     // 建立智能合約物件/實例\r\n//     const contractObject = new web3.eth.Contract(\r\n//         compileContract.abi,\r\n//         contractReceipt.address\r\n//     );\r\n\r\n//     return contractObject;\r\n// };\r\n\r\nconst getContractObject = () => {\r\n    // 從 Local Storage 中获取收据地址\r\n    const receiptAddress = localStorage.getItem('receiptAddress');\r\n  \r\n    // 如果没有收据地址，则返回 null 或者进行错误处理\r\n    if (!receiptAddress) {\r\n        console.error('Receipt address not found in local storage.');\r\n        return null;\r\n    }\r\n  \r\n    // 建立智能合约物件/实例\r\n    const contractObject = new web3.eth.Contract(\r\n        compileContract.abi,\r\n        receiptAddress\r\n    );\r\n  \r\n    return contractObject;\r\n  };\r\n\r\n\r\nconst payee = async () => {\r\n    const contractObject = getContractObject();\r\n    const result = await contractObject.methods.payee().call();\r\n    return result;\r\n};\r\n\r\nconst payer = async () => {\r\n    const contractObject = getContractObject();\r\n    const result = await contractObject.methods.payer().call();\r\n    return result;\r\n};\r\n\r\nconst amount = async () => {\r\n    const contractObject = getContractObject();\r\n    const result = await contractObject.methods.amount().call();\r\n    return result;\r\n};\r\n\r\nconst deadline = async () => {\r\n    const contractObject = getContractObject();\r\n    const result = await contractObject.methods.deadline().call();\r\n    return result;\r\n};\r\n\r\nconst checkContractStatus = async () => {\r\n    const contractObject = getContractObject();\r\n    const result = await contractObject.methods.checkContractStatus().call();\r\n    return result;\r\n};\r\n\r\nconst finishContract = async () => {\r\n    const accounts = await web3.eth.getAccounts();\r\n    const contractObject = getContractObject();\r\n    const receipt = await contractObject.methods.finishContract().send({ from: accounts[0], gas: 1000000 });\r\n    console.info(receipt);\r\n    console.info(\"Contract successfully finished!\");\r\n    return receipt;\r\n};\r\n\r\nconst terminateContract = async () => {\r\n    const accounts = await web3.eth.getAccounts();\r\n    const contractObject = getContractObject();\r\n    const receipt = await contractObject.methods.terminateContract().send({ from: accounts[0], gas: 1000000 });\r\n    console.info(receipt);\r\n    console.info(\"Contract successfully terminated!\");\r\n    return receipt;\r\n};\r\n\r\nconst prePay = async (value) => {\r\n    const accounts = await web3.eth.getAccounts();\r\n    const contractObject = getContractObject();\r\n    const receipt = await contractObject.methods.prePay().send({\r\n      from: accounts[0],\r\n      value: web3.utils.toWei(value, 'ether'),\r\n      gas: 1000000\r\n    });\r\n    console.info(receipt);\r\n    console.info(\"Pre-payment successful!\");\r\n    return receipt;\r\n  };\r\n  \r\n  const shipItem = async () => {\r\n    const accounts = await web3.eth.getAccounts();\r\n    const contractObject = getContractObject();\r\n    const receipt = await contractObject.methods.shipItem().send({ from: accounts[0], gas: 1000000 });\r\n    console.info(receipt);\r\n    console.info(\"Item shipped successfully!\");\r\n    return receipt;\r\n  };\r\n  \r\n  const confirmReceived = async () => {\r\n    const accounts = await web3.eth.getAccounts();\r\n    const contractObject = getContractObject();\r\n    const receipt = await contractObject.methods.confirmReceived().send({ from: accounts[0], gas: 1000000 });\r\n    console.info(receipt);\r\n    console.info(\"Item received successfully!\");\r\n    return receipt;\r\n  };\r\n  \r\n  module.exports = {\r\n    payee,\r\n    payer,\r\n    amount,\r\n    deadline,\r\n    checkContractStatus,\r\n    finishContract,\r\n    terminateContract,\r\n    prePay,\r\n    shipItem,\r\n    confirmReceived\r\n  };\r\n  \r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}